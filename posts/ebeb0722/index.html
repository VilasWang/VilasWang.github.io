<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Nginx Ubuntu 反向代理指南 | CodeVerse | 技术宇宙</title><meta name="author" content="vilas"><meta name="copyright" content="vilas"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="详细的技术安装与配置指南，提供从零开始的完整部署流程，包含环境检查、依赖安装、参数配置、测试验证等关键步骤。">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx Ubuntu 反向代理指南">
<meta property="og:url" content="https://vilaswang.github.io/posts/ebeb0722/index.html">
<meta property="og:site_name" content="CodeVerse | 技术宇宙">
<meta property="og:description" content="详细的技术安装与配置指南，提供从零开始的完整部署流程，包含环境检查、依赖安装、参数配置、测试验证等关键步骤。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vilaswang.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-12-04T14:25:54.000Z">
<meta property="article:modified_time" content="2025-12-17T15:36:29.295Z">
<meta property="article:author" content="vilas">
<meta property="article:tag" content="HTTPS">
<meta property="article:tag" content="Let&#39;s Encrypt">
<meta property="article:tag" content="Nginx">
<meta property="article:tag" content="SSL">
<meta property="article:tag" content="Ubuntu">
<meta property="article:tag" content="反向代理">
<meta property="article:tag" content="负载均衡">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vilaswang.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Nginx Ubuntu 反向代理指南",
  "url": "https://vilaswang.github.io/posts/ebeb0722/",
  "image": "https://vilaswang.github.io/img/butterfly-icon.png",
  "datePublished": "2025-12-04T14:25:54.000Z",
  "dateModified": "2025-12-17T15:36:29.295Z",
  "author": [
    {
      "@type": "Person",
      "name": "vilas",
      "url": "https://VilasWang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://vilaswang.github.io/posts/ebeb0722/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nginx Ubuntu 反向代理指南',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><style> .top-announcement { background: linear-gradient(90deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); color: #333; text-align: center; padding: 10px 0; font-size: 14px; font-weight: bold; width: 100%; border-bottom: 1px solid #eee; } </style><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="CodeVerse | 技术宇宙" type="application/atom+xml">
</head><body><div class="bg-animation" id="web_bg" style="background: [object Object];"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">155</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user-circle"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">CodeVerse | 技术宇宙</span></a><a class="nav-page-title" href="/"><span class="site-name">Nginx Ubuntu 反向代理指南</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user-circle"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Nginx Ubuntu 反向代理指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-12-04T14:25:54.000Z" title="发表于 2025-12-04 22:25:54">2025-12-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-17T15:36:29.295Z" title="更新于 2025-12-17 23:36:29">2025-12-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/">后端服务架构</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/Web%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/">Web服务器配置</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Nginx-Ubuntu-反向代理指南"><a href="#Nginx-Ubuntu-反向代理指南" class="headerlink" title="Nginx Ubuntu 反向代理指南"></a>Nginx Ubuntu 反向代理指南</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%AE%89%E8%A3%85-nginx">第一步：安装 Nginx</a></li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E8%AE%BE%E7%BD%AE%E5%9F%BA%E7%A1%80-web-%E6%9C%8D%E5%8A%A1%E5%99%A8">第二步：设置基础 Web 服务器</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E9%85%8D%E7%BD%AE%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%8E-https">第三步：配置反向代理与 HTTPS</a></li>
<li><a href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E4%BD%BF%E7%94%A8-certbot-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-ssl">第四步：使用 Certbot 自动配置 SSL</a></li>
<li><a href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA%E6%9C%AC%E5%9C%B0%E5%BA%94%E7%94%A8%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-%E5%8F%AF%E9%80%89">第五步：配置多个本地应用的反向代理 (可选)</a></li>
<li><a href="#%E7%AC%AC%E5%85%AD%E6%AD%A5%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1-%E5%8F%AF%E9%80%89">第六步：配置负载均衡 (可选)</a></li>
<li><a href="#%E9%99%84%E5%BD%95%E6%80%A7%E8%83%BD%E4%B8%8E%E5%AE%89%E5%85%A8%E4%BC%98%E5%8C%96">附录：性能与安全优化</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a></li>
</ul>
<h2 id="第一步：安装-Nginx"><a href="#第一步：安装-Nginx" class="headerlink" title="第一步：安装 Nginx"></a>第一步：安装 Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl status nginx</span><br></pre></td></tr></table></figure>
<p>安装完成后，通过浏览器访问 <code>http://&lt;你的服务器IP&gt;</code>，应能看到 Nginx 的欢迎页面。</p>
<h2 id="第二步：设置基础-Web-服务器"><a href="#第二步：设置基础-Web-服务器" class="headerlink" title="第二步：设置基础 Web 服务器"></a>第二步：设置基础 Web 服务器</h2><p>即使我们主要用 Nginx 做反向代理，创建一个基础的服务器块（Server Block）也是一个好习惯。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /var/www/your_domain.com/html</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> -R <span class="variable">$USER</span>:<span class="variable">$USER</span> /var/www/your_domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> nano /etc/nginx/sites-available/your_domain.com</span><br></pre></td></tr></table></figure>

<p>将以下基础配置粘贴进去：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> /var/www/your_domain.com/html;</span><br><span class="line">    <span class="attribute">index</span> index.html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> your_domain.com www.your_domain.com;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /etc/nginx/sites-available/your_domain.com /etc/nginx/sites-enabled/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart nginx</span><br></pre></td></tr></table></figure>

<h2 id="第三步：配置反向代理与-HTTPS"><a href="#第三步：配置反向代理与-HTTPS" class="headerlink" title="第三步：配置反向代理与 HTTPS"></a>第三步：配置反向代理与 HTTPS</h2><p>现在，我们将修改配置文件，使其将 HTTP 请求重定向到 HTTPS，并将所有流量反向代理到一个后端应用（例如，一个运行在 <code>localhost:8080</code> 的 Node.js 或 Java 应用）。</p>
<p>编辑你的配置文件：<code>sudo nano /etc/nginx/sites-available/your_domain.com</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> your_domain.com www.your_domain.com;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将所有 HTTP 请求 301 重定向到 HTTPS</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> your_domain.com www.your_domain.com;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 证书路径 (稍后由 Certbot 自动填充)</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/your_domain.com/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/your_domain.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># --- SSL/TLS 安全增强配置 ---</span></span><br><span class="line">    <span class="comment"># 推荐只使用 TLS 1.2 和 1.3，这是当前的安全标准</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># 现代 OpenSSL 兼容的安全加密套件（2024年推荐）</span></span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 会话缓存优化</span></span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">10m</span>;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">10m</span>;</span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># OCSP Stapling</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">resolver</span> <span class="number">8.8.8.8</span> <span class="number">8.8.4.4</span> valid=<span class="number">300s</span>;</span><br><span class="line">    <span class="attribute">resolver_timeout</span> <span class="number">5s</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># --- 安全头 (Security Headers) ---</span></span><br><span class="line">    <span class="comment"># HSTS (HTTP Strict Transport Security): 强制客户端在指定时间内只能通过 HTTPS 访问</span></span><br><span class="line">    <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=15768000; includeSubDomains; preload&quot;</span> always;</span><br><span class="line">    <span class="comment"># X-Frame-Options: 防止点击劫持攻击</span></span><br><span class="line">    <span class="attribute">add_header</span> X-Frame-Options DENY;</span><br><span class="line">    <span class="comment"># X-Content-Type-Options: 防止 MIME 类型嗅探攻击</span></span><br><span class="line">    <span class="attribute">add_header</span> X-Content-Type-Options nosniff;</span><br><span class="line">    <span class="comment"># X-XSS-Protection: 启用 XSS 保护</span></span><br><span class="line">    <span class="attribute">add_header</span> X-XSS-Protection <span class="string">&quot;1; mode=block&quot;</span>;</span><br><span class="line">    <span class="comment"># Referrer Policy: 控制referrer信息发送</span></span><br><span class="line">    <span class="attribute">add_header</span> Referrer-Policy <span class="string">&quot;strict-origin-when-cross-origin&quot;</span>;</span><br><span class="line">    <span class="comment"># Content Security Policy: 防止代码注入攻击（基础配置）</span></span><br><span class="line">    <span class="attribute">add_header</span> Content-Security-Policy <span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; img-src &#x27;self&#x27; data: https:; font-src &#x27;self&#x27; data: https:; connect-src &#x27;self&#x27;; frame-ancestors &#x27;none&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 核心：反向代理配置</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># 将请求转发到后端应用</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8080;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置必要的请求头，以便后端应用能获取到真实的客户端信息</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># WebSocket 支持 (如果后端应用需要)</span></span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第四步：使用-Certbot-自动配置-SSL"><a href="#第四步：使用-Certbot-自动配置-SSL" class="headerlink" title="第四步：使用 Certbot 自动配置 SSL"></a>第四步：使用 Certbot 自动配置 SSL</h2><p>Let’s Encrypt 提供免费的 SSL 证书，<code>certbot</code> 是其官方推荐的客户端。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y certbot python3-certbot-nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> certbot --nginx -d your_domain.com -d www.your_domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> certbot renew --dry-run</span><br></pre></td></tr></table></figure>
<p>执行完毕后，你的网站就应该可以通过 <code>https://your_domain.com</code> 访问了。</p>
<h2 id="第五步：配置多个本地应用的反向代理-可选"><a href="#第五步：配置多个本地应用的反向代理-可选" class="headerlink" title="第五步：配置多个本地应用的反向代理 (可选)"></a>第五步：配置多个本地应用的反向代理 (可选)</h2><p>如果你有多个本地应用需要通过同一个域名访问，可以基于不同的路径前缀进行反向代理配置。</p>
<p>编辑你的配置文件：<code>sudo nano /etc/nginx/sites-available/your_domain.com</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> your_domain.com www.your_domain.com;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 证书路径 (由 Certbot 自动配置)</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/your_domain.com/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/your_domain.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL/TLS 安全配置...</span></span><br><span class="line">    <span class="comment"># (同之前的配置)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># --- 多个应用的反向代理配置 ---</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># API 服务 (运行在端口 3000)</span></span><br><span class="line">    <span class="section">location</span> /api/ &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:3000/;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置必要的请求头</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># API 服务优化配置</span></span><br><span class="line">        <span class="attribute">proxy_buffering</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span> <span class="number">4k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span> <span class="number">8</span> <span class="number">4k</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 管理后台 (运行在端口 8080)</span></span><br><span class="line">    <span class="section">location</span> /admin/ &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8080/;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置必要的请求头</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># WebSocket 服务 (运行在端口 9090)</span></span><br><span class="line">    <span class="section">location</span> /ws/ &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:9090/;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># WebSocket 特殊配置</span></span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># WebSocket 超时配置</span></span><br><span class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">86400</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">86400</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 静态文件服务 (前端应用，运行在端口 3001)</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:3001/;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置必要的请求头</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 静态文件优化</span></span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 特定文件类型的缓存配置</span></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$</span> &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:3001;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 缓存配置</span></span><br><span class="line">        <span class="attribute">expires</span> <span class="number">1y</span>;</span><br><span class="line">        <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;public, immutable&quot;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> Vary Accept-Encoding;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h3><ol>
<li><p><strong>路径匹配规则</strong>：</p>
<ul>
<li><code>/api/</code> → 匹配所有以 <code>/api/</code> 开头的请求</li>
<li><code>/admin/</code> → 匹配所有以 <code>/admin/</code> 开头的请求</li>
<li><code>/ws/</code> → 匹配所有以 <code>/ws/</code> 开头的请求</li>
<li><code>/</code> → 匹配所有其他请求（默认）</li>
</ul>
</li>
<li><p><strong>proxy_pass 路径处理</strong>：</p>
<ul>
<li><code>proxy_pass http://127.0.0.1:3000/</code> → 末尾的 <code>/</code> 会将匹配的 location 路径部分完全替换</li>
<li>例如：<code>/api/users</code> → 转发到 <code>http://127.0.0.1:3000/users</code>（<code>/api/</code> 被完全移除）</li>
</ul>
<p>对比示例：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 带末尾斜杠（移除匹配路径）</span></span><br><span class="line"><span class="section">location</span> /api/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3000/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># /api/users → http://127.0.0.1:3000/users</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不带末尾斜杠（保留完整路径）</span></span><br><span class="line"><span class="section">location</span> /api/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3000;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># /api/users → http://127.0.0.1:3000/api/users</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>WebSocket 支持注意事项</strong>：</p>
<ul>
<li>必须设置 <code>proxy_http_version 1.1</code></li>
<li>必须添加 <code>Upgrade</code> 和 <code>Connection</code> 头</li>
<li>建议增加超时时间，防止连接断开</li>
</ul>
</li>
<li><p><strong>测试配置</strong>：</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line">curl -I https://your_domain.com</span><br></pre></td></tr></table></figure>

<h2 id="第六步：配置负载均衡-可选"><a href="#第六步：配置负载均衡-可选" class="headerlink" title="第六步：配置负载均衡 (可选)"></a>第六步：配置负载均衡 (可选)</h2><p>如果你有多个后端应用服务器，可以使用 Nginx 的 <code>upstream</code> 模块来实现负载均衡。</p>
<p>编辑你的配置文件：<code>sudo nano /etc/nginx/sites-available/your_domain.com</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">    <span class="comment"># 默认策略是轮询 (Round Robin)</span></span><br><span class="line">    <span class="attribute">server</span> backend1.example.com:<span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server</span> backend2.example.com:<span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 也可以指定权重 (weight)</span></span><br><span class="line">    <span class="comment"># server backend1.example.com:8080 weight=3;</span></span><br><span class="line">    <span class="comment"># server backend2.example.com:8080 weight=1;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 或者使用 ip_hash 策略，确保同一客户端总是访问同一台服务器</span></span><br><span class="line">    <span class="comment"># ip_hash;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> your_domain.com;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 证书配置（同前文）</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/your_domain.com/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/your_domain.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 安全配置（同前文）</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># 将请求转发到上游服务器组</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://backend_servers;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置必要的请求头</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改配置后，不要忘记测试和重启 Nginx：<code>sudo nginx -t &amp;&amp; sudo systemctl restart nginx</code>。</p>
<h2 id="附录：性能与安全优化"><a href="#附录：性能与安全优化" class="headerlink" title="附录：性能与安全优化"></a>附录：性能与安全优化</h2><h3 id="Gzip-压缩"><a href="#Gzip-压缩" class="headerlink" title="Gzip 压缩"></a>Gzip 压缩</h3><p>在 <code>/etc/nginx/nginx.conf</code> 的 <code>http</code> 块中添加或取消注释：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_proxied</span> any;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span></span><br><span class="line">        text/plain</span><br><span class="line">        text/css</span><br><span class="line">        text/xml</span><br><span class="line">        text/javascript</span><br><span class="line">        application/javascript</span><br><span class="line">        application/xml+rss</span><br><span class="line">        application/json</span><br><span class="line">        application/xml</span><br><span class="line">        image/svg+xml;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="隐藏-Nginx-版本号"><a href="#隐藏-Nginx-版本号" class="headerlink" title="隐藏 Nginx 版本号"></a>隐藏 Nginx 版本号</h3><p>同样在 <code>http</code> 块中添加：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缓冲区优化"><a href="#缓冲区优化" class="headerlink" title="缓冲区优化"></a>缓冲区优化</h3><p>在 <code>http</code> 或 <code>server</code> 块中配置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="attribute">client_body_buffer_size</span> <span class="number">128k</span>;</span><br><span class="line"><span class="attribute">client_max_body_size</span> <span class="number">20m</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="attribute">proxy_buffering</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">proxy_buffer_size</span> <span class="number">4k</span>;</span><br><span class="line"><span class="attribute">proxy_buffers</span> <span class="number">8</span> <span class="number">4k</span>;</span><br><span class="line"><span class="attribute">proxy_busy_buffers_size</span> <span class="number">8k</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="attribute">client_header_timeout</span> <span class="number">10</span>;</span><br><span class="line"><span class="attribute">client_body_timeout</span> <span class="number">10</span>;</span><br><span class="line"><span class="attribute">keepalive_timeout</span> <span class="number">65</span>;</span><br><span class="line"><span class="attribute">send_timeout</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="连接限制"><a href="#连接限制" class="headerlink" title="连接限制"></a>连接限制</h3><p>防止 DoS 攻击：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="attribute">limit_conn_zone</span> <span class="variable">$binary_remote_addr</span> zone=addr:<span class="number">10m</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx Ubuntu 反向代理指南</span></span><br><span class="line"><span class="attribute">limit_conn</span> addr <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="禁用不安全的-HTTP-方法"><a href="#禁用不安全的-HTTP-方法" class="headerlink" title="禁用不安全的 HTTP 方法"></a>禁用不安全的 HTTP 方法</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="comment"># 禁用 TRACE 和 TRACK 方法</span></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$request_method</span> <span class="regexp">~ ^(TRACE|TRACK)$)</span> &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">405</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><p><strong>Q: 502 Bad Gateway 错误?</strong><br><strong>A</strong>: 这通常意味着 Nginx 无法连接到你的后端应用。请检查：</p>
<ol>
<li>你的后端应用（如 Node.js, Java）是否正在 <code>127.0.0.1:8080</code> 上正常运行。</li>
<li>检查后端应用的防火墙设置。</li>
<li>查看 Nginx 的错误日志 <code>sudo tail -f /var/log/nginx/error.log</code>。</li>
</ol>
<p><strong>Q: HTTPS 网站提示不安全?</strong><br><strong>A</strong>: 这通常是 SSL 证书配置问题。</p>
<ol>
<li>确保证书路径正确。</li>
<li>确保证书链完整 (<code>fullchain.pem</code>)。</li>
<li>使用 SSL Labs 的 <a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/">SSL Test</a> 工具来全面分析你的 HTTPS 配置。</li>
</ol>
<p><strong>Q: 证书续期失败?</strong></p>
<p><strong>A</strong>: 检查以下几点：</p>
<ol>
<li>确认服务器时间正确：<code>sudo timedatectl status</code></li>
<li>手动测试续期：<code>sudo certbot renew --dry-run</code></li>
<li>检查 cron 或 systemd timer 是否正常运行：<code>sudo systemctl status certbot.timer</code></li>
</ol>
<p><strong>Q: WebSocket 连接失败?</strong></p>
<p><strong>A</strong>: 检查以下配置：</p>
<ol>
<li>确保设置了 <code>proxy_http_version 1.1</code></li>
<li>确保添加了正确的 <code>Upgrade</code> 和 <code>Connection</code> 头</li>
<li>检查后端应用是否支持 WebSocket</li>
<li>确认超时设置足够长</li>
</ol>
<p><strong>Q: 静态文件 404 错误?</strong></p>
<p><strong>A</strong>: 可能的原因：</p>
<ol>
<li>后端应用端口未正确启动</li>
<li>静态文件路径不正确</li>
<li>权限问题：检查 <code>sudo chown -R www-data:www-data /var/www/</code></li>
<li>检查 SELinux 或 AppArmor 是否阻止访问</li>
</ol>
<p><strong>Q: 如何查看 Nginx 访问日志和错误日志?</strong></p>
<p><strong>A</strong>: 日志文件位置：</p>
<ul>
<li>访问日志：<code>/var/log/nginx/access.log</code></li>
<li>错误日志：<code>/var/log/nginx/error.log</code></li>
<li>实时监控：<code>sudo tail -f /var/log/nginx/error.log</code></li>
</ul>
<p><strong>Q: 如何重载 Nginx 配置而不中断服务?</strong></p>
<p><strong>A</strong>: 使用重载命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nginx -t &amp;&amp; <span class="built_in">sudo</span> systemctl reload nginx</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://VilasWang.github.io">vilas</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://vilaswang.github.io/posts/ebeb0722/">https://vilaswang.github.io/posts/ebeb0722/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://VilasWang.github.io" target="_blank">CodeVerse | 技术宇宙</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Nginx/">Nginx</a><a class="post-meta__tags" href="/tags/Ubuntu/">Ubuntu</a><a class="post-meta__tags" href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">反向代理</a><a class="post-meta__tags" href="/tags/HTTPS/">HTTPS</a><a class="post-meta__tags" href="/tags/SSL/">SSL</a><a class="post-meta__tags" href="/tags/Let-s-Encrypt/">Let's Encrypt</a><a class="post-meta__tags" href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">负载均衡</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/f4106d49/" title="OpenSSL mTLS 指南"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">OpenSSL mTLS 指南</div></div><div class="info-2"><div class="info-item-1">OpenSSL mTLS 指南目录 概述 第一步：生成根证书 (CA) 第二步：生成服务器证书 第三步：生成客户端证书 第四步：验证与打包 附录A：完整自动化脚本 附录B：在 Nginx 中配置双向认证 附录C：生成 DH 参数 (可选) 附录D：常用 OpenSSL 命令  概述双向认证（Mutual TLS, mTLS）是一种高安全性的认证模式，它要求客户端和服务器双方都出示并验证对方的数字证书，从而确保通信双方的身份都是可信的。本指南将详细介绍如何使用 OpenSSL 创建一套完整的、用于双向认证的证书。 证书体系我们将创建以下三类证书：  根证书 (CA): 证书颁发机构，用于签发服务器和客户端证书。它是信任链的顶点。 服务器证书: 用于向客户端证明服务器的身份。 客户端证书: 用于向服务器证明客户端的身份。  第一步：生成根证书 (CA)CA 是整个信任体系的基础，其私钥必须被严格保管。 1. 创建 CA 私钥12345# OpenSSL mTLS 指南openssl genrsa -out ca.key 4096# OpenSSL mTLS 指南chmod 400 c...</div></div></div></a><a class="pagination-related" href="/posts/75dde51b/" title="Qt 单元测试指南"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Qt 单元测试指南</div></div><div class="info-2"><div class="info-item-1">Qt 单元测试指南目录 概述 第一步：项目配置 第二步：编写基础测试 第三步：数据驱动测试 第四步：GUI 测试 第五步：使用模拟对象 (Mocking) 第六步：运行测试与生成报告 附录：持续集成 (CI&#x2F;CD)  概述单元测试是保证代码质量、方便重构、减少 Bug 的关键实践。Qt 提供了自家的测试框架 Qt Test，它轻量、快速，并与 Qt 的元对象系统和事件循环深度集成，尤其擅长进行 GUI 测试。 第一步：项目配置要开始使用 Qt Test，首先需要配置你的 .pro 文件。 12345678910111213# Qt 单元测试指南# Qt 单元测试指南QT += testlib# Qt 单元测试指南CONFIG += testcase# Qt 单元测试指南SOURCES += test_calculator.cppHEADERS += test_calculator.h# Qt 单元测试指南# Qt 单元测试指南  第二步：编写基础测试一个测试用例通常是一个继承自 QObject 的类，其中包含一系列以 test 开头的私有槽函数 (private slo...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/d0dcdb61/" title="Apache Ubuntu 反向代理指南"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-04</div><div class="info-item-2">Apache Ubuntu 反向代理指南</div></div><div class="info-2"><div class="info-item-1">Apache Ubuntu 反向代理指南目录 第一步：安装 Apache 第二步：设置虚拟主机 (Virtual Host) 第三步：配置反向代理 第四步：使用 Certbot 配置 HTTPS 附录：性能与安全优化 常见问题  第一步：安装 Apache1234567891011# Apache Ubuntu 反向代理指南sudo apt update# Apache Ubuntu 反向代理指南sudo apt install apache2# Apache Ubuntu 反向代理指南sudo ufw allow &#x27;Apache Full&#x27;# Apache Ubuntu 反向代理指南sudo systemctl status apache2 安装完成后，通过浏览器访问 http://&lt;你的服务器IP&gt;，应能看到 Apache 的默认欢迎页面。 第二步：设置虚拟主机 (Virtual Host)虚拟主机允许你在同一台服务器上托管多个网站。 123456# Apache Ubuntu 反向代理指南sudo mkdir -p /var/www/your...</div></div></div></a><a class="pagination-related" href="/posts/cf6de084/" title="Linux atop 监控工具使用指南"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-04</div><div class="info-item-2">Linux atop 监控工具使用指南</div></div><div class="info-2"><div class="info-item-1">Linux atop 监控工具使用指南目录 概述 第一步：安装 atop 第二步：安装 netatop 网络监控模块 (可选) 第三步：配置 atop 服务 第四步：使用 atop 第五步：分析历史日志 附录：监控字段说明 常见问题  概述atop 是一个高级的、可交互的 Linux 系统性能监控工具。与 top、htop 等工具相比，atop 最强大的特性是它能够记录历史性能数据，并允许你像播放视频一样“回放”系统在过去某个时间点的状态，极大地便利了问题排查和性能分析。 主要特性 全面监控: 监控 CPU、内存、交换空间、磁盘 I&#x2F;O、网络以及各个进程的资源使用情况。 历史记录: 默认以10分钟为间隔，将系统快照记录到日志文件中，并保留28天。 进程级详情: 记录每个进程的资源使用、状态、退出码等详细信息。 高亮显示: 对过载的系统资源使用不同颜色高亮显示，一目了然。  第一步：安装 atopUbuntu&#x2F;Debian12345678# Linux atop 监控工具使用指南sudo apt update# Linux atop 监控工具使用指南sudo a...</div></div></div></a><a class="pagination-related" href="/posts/e0946359/" title="Ubuntu CPP 开发环境配置指南"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-04</div><div class="info-item-2">Ubuntu CPP 开发环境配置指南</div></div><div class="info-2"><div class="info-item-1">Ubuntu CPP 开发环境配置指南目录 概述 第一步：系统更新和基础工具安装 第二步：安装编译器工具链 第三步：安装构建工具 第四步：安装调试工具 第五步：安装常用开发库 第六步：配置 IDE 和编辑器 第七步：验证开发环境 第八步：配置环境变量 附录：常用命令速查 常见问题  概述本文档提供了在 Ubuntu 22.04 LTS 系统上搭建完整 C++ 开发环境的详细步骤。无论您是 C++ 初学者还是有经验的开发者，都可以按照本指南快速配置一个功能完整的开发环境。 主要组件 编译器: GCC&#x2F;G++ (支持 C++11&#x2F;14&#x2F;17&#x2F;20) 构建系统: CMake, Make 调试器: GDB 包管理: apt, vcpkg IDE: Visual Studio Code (可选) 版本控制: Git  第一步：系统更新和基础工具安装1. 更新系统包12345678# Ubuntu CPP 开发环境配置指南sudo apt update# Ubuntu CPP 开发环境配置指南sudo apt upgrade -y# Ubuntu CP...</div></div></div></a><a class="pagination-related" href="/posts/f4106d49/" title="OpenSSL mTLS 指南"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-04</div><div class="info-item-2">OpenSSL mTLS 指南</div></div><div class="info-2"><div class="info-item-1">OpenSSL mTLS 指南目录 概述 第一步：生成根证书 (CA) 第二步：生成服务器证书 第三步：生成客户端证书 第四步：验证与打包 附录A：完整自动化脚本 附录B：在 Nginx 中配置双向认证 附录C：生成 DH 参数 (可选) 附录D：常用 OpenSSL 命令  概述双向认证（Mutual TLS, mTLS）是一种高安全性的认证模式，它要求客户端和服务器双方都出示并验证对方的数字证书，从而确保通信双方的身份都是可信的。本指南将详细介绍如何使用 OpenSSL 创建一套完整的、用于双向认证的证书。 证书体系我们将创建以下三类证书：  根证书 (CA): 证书颁发机构，用于签发服务器和客户端证书。它是信任链的顶点。 服务器证书: 用于向客户端证明服务器的身份。 客户端证书: 用于向服务器证明客户端的身份。  第一步：生成根证书 (CA)CA 是整个信任体系的基础，其私钥必须被严格保管。 1. 创建 CA 私钥12345# OpenSSL mTLS 指南openssl genrsa -out ca.key 4096# OpenSSL mTLS 指南chmod 400 c...</div></div></div></a><a class="pagination-related" href="/posts/616ce96e/" title="HM MES 部署指南"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-04</div><div class="info-item-2">HM MES 部署指南</div></div><div class="info-2"><div class="info-item-1">HM MES 部署指南目录 概述 环境准备 后端编译与部署 前端部署与反向代理 常见问题排查  概述Hm-MES 是一个基于 Java Spring Boot 的制造执行系统（MES），提供生产管理、质量控制、设备管理等一系列功能。本指南提供在 Windows 和 Ubuntu 系统上完整编译和部署 Hm-MES 的详细步骤。 系统架构 后端: Java Spring Boot + MyBatis 前端: HTML5 + JavaScript 中间件: Apache Tomcat 数据库: MySQL 8.0 消息队列 (可选): RabbitMQ 反向代理 (可选): Nginx  环境准备1. 软件依赖 JDK: 11 (推荐，LTS版本) Maven: 3.6+ Tomcat: 9.0+ MySQL: 8.0+ Git  2. 硬件要求 最小配置: 2核CPU, 4GB内存, 20GB磁盘空间 推荐配置: 4核CPU, 8GB内存, 50GB磁盘空间 生产环境: 8核CPU, 16GB内存, 100GB SSD磁盘  2. Windows 环境准备 安装 JDK: 从 Ad...</div></div></div></a><a class="pagination-related" href="/posts/d1520bc/" title="OpenSSL mTLS Windows 指南"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-04</div><div class="info-item-2">OpenSSL mTLS Windows 指南</div></div><div class="info-2"><div class="info-item-1">OpenSSL mTLS Windows 指南目录 概述 第一步：在 Windows 上安装 OpenSSL 第二步：生成根证书 (CA) 第三步：生成服务器证书 第四步：生成客户端证书 第五步：验证与打包 附录A：Windows 批处理自动化脚本 附录B：在 IIS 中配置双向认证 附录C：在 Nginx for Windows 中配置双向认证 附录D：生成 DH 参数 (可选) 附录E：常用 OpenSSL 命令  概述双向认证（Mutual TLS, mTLS）是一种高安全性的认证模式，它要求客户端和服务器双方都出示并验证对方的数字证书，从而确保通信双方的身份都是可信的。本指南将详细介绍如何在 Windows 系统上使用 OpenSSL 创建一套完整的、用于双向认证的证书。 Windows 环境注意事项 Windows 系统默认不包含 OpenSSL，需要单独安装 路径分隔符使用反斜杠 \ 批处理脚本使用 .bat 格式 文件权限管理与 Linux 不同  第一步：在 Windows 上安装 OpenSSL方法1：使用 Chocolatey (推荐)123456# Open...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">vilas</div><div class="author-info-description">CodeVerse | 技术宇宙 - 专注于 C++、Qt、系统架构与性能优化的技术知识库。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">155</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><a id="card-info-btn" href="/about/"><i class="fa fa-paper-plane"></i><span>关于</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/VilasWang" target="_blank" title="fab fa-github"><i class="Github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">🚀 欢迎来到 CodeVerse！这里专注于深度技术解析与实战经验分享。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx-Ubuntu-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%8C%87%E5%8D%97"><span class="toc-number">1.</span> <span class="toc-text">Nginx Ubuntu 反向代理指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%AE%89%E8%A3%85-Nginx"><span class="toc-number">1.2.</span> <span class="toc-text">第一步：安装 Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%AE%BE%E7%BD%AE%E5%9F%BA%E7%A1%80-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">第二步：设置基础 Web 服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AE%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%8E-HTTPS"><span class="toc-number">1.4.</span> <span class="toc-text">第三步：配置反向代理与 HTTPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E4%BD%BF%E7%94%A8-Certbot-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-SSL"><span class="toc-number">1.5.</span> <span class="toc-text">第四步：使用 Certbot 自动配置 SSL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA%E6%9C%AC%E5%9C%B0%E5%BA%94%E7%94%A8%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-%E5%8F%AF%E9%80%89"><span class="toc-number">1.6.</span> <span class="toc-text">第五步：配置多个本地应用的反向代理 (可选)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.1.</span> <span class="toc-text">配置说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1-%E5%8F%AF%E9%80%89"><span class="toc-number">1.7.</span> <span class="toc-text">第六步：配置负载均衡 (可选)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95%EF%BC%9A%E6%80%A7%E8%83%BD%E4%B8%8E%E5%AE%89%E5%85%A8%E4%BC%98%E5%8C%96"><span class="toc-number">1.8.</span> <span class="toc-text">附录：性能与安全优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gzip-%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.8.1.</span> <span class="toc-text">Gzip 压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F-Nginx-%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="toc-number">1.8.2.</span> <span class="toc-text">隐藏 Nginx 版本号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E4%BC%98%E5%8C%96"><span class="toc-number">1.8.3.</span> <span class="toc-text">缓冲区优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E9%99%90%E5%88%B6"><span class="toc-number">1.8.4.</span> <span class="toc-text">连接限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84-HTTP-%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.5.</span> <span class="toc-text">禁用不安全的 HTTP 方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.</span> <span class="toc-text">常见问题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/mcp-github-config/" title="Gemini CLI 和 Claude Code 中配置 GitHub MCP 服务器详解">Gemini CLI 和 Claude Code 中配置 GitHub MCP 服务器详解</a><time datetime="2025-12-18T01:09:23.000Z" title="发表于 2025-12-18 09:09:23">2025-12-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/gemini-cli-proxy/" title="Gemini CLI 在国内网络环境下的完整配置指南">Gemini CLI 在国内网络环境下的完整配置指南</a><time datetime="2025-12-18T01:09:23.000Z" title="发表于 2025-12-18 09:09:23">2025-12-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/windows-github-mcp/" title="Windows 环境下配置 GitHub MCP 服务器完整指南">Windows 环境下配置 GitHub MCP 服务器完整指南</a><time datetime="2025-12-18T01:09:23.000Z" title="发表于 2025-12-18 09:09:23">2025-12-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/56a10ecb/" title="Antigravity 登录认证完整解决方案（非TUN方法）">Antigravity 登录认证完整解决方案（非TUN方法）</a><time datetime="2025-12-16T22:30:00.000Z" title="发表于 2025-12-17 06:30:00">2025-12-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/55a960b4/" title="VSCode Qt MSVC 配置指南">VSCode Qt MSVC 配置指南</a><time datetime="2025-12-09T06:09:56.000Z" title="发表于 2025-12-09 14:09:56">2025-12-09</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By vilas</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'VilasWang/VilasWang.github.io',
      'data-repo-id': 'R_kgDOQkzqvg',
      'data-category-id': 'DIC_kwDOQkzqvs4Cz99h',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !true) {
    if (true) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script> document.addEventListener('DOMContentLoaded', function() { var announcement = document.createElement('div'); announcement.className = 'top-announcement'; announcement.innerHTML = '🚀 欢迎来到 CodeVerse 技术宇宙！'; document.body.insertBefore(announcement, document.body.firstChild); }); </script><script id="canvas_nest" defer="defer" color="102,204,255" opacity="0.6" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:description\"]","link[rel=\"canonical\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.3"></script></div></div></body></html>